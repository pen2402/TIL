# 주기억장치

## 기억장치의 분류

### 액세스 방법에 따른 유형

- 순차 액세스(Sequential Access)
  - 저장된 정보를 처음부터 순서대로 액세스하는 방식
    - 자기 테이프(Magnetic Tape) 저장장치 등
  - 레코드 단위로 저장되며 각 레코드는 고유의 주소를 가짐
  - 임의의 위치에 저장된 정보를 검색하여 읽기 위해서는 해당 위치까지 테이프를 회전시켜야 함
    - 위치에 따라 액세스 시간이 달라짐
- 직접 액세스(Direct Access)
  - 액세스할 위치 근처로 직접 이동한 다음 순차적 검색을 통해 최종 위치에 도달하는 방식
    - 자기 디스크(Magnetic Disk), CD-ROM 등
  - 디스크 쓰기
    - 트랙상에 데이터를 저장하는 동작
    - 자기 이력 현상에 의해 자성 패턴이 표면에 기록
      - 자기 이력 현상(Hysteresis Phenomena)
        - 강자성 물질이 자기장의 변화에 따른 자기화가 자기장에 비해 뒤쳐지는 현상
        - 외부 자계를 가해도 자성체 내부에 잔류 자기 성분이 존재
        - 외부 자계를 제거해도 자성체의 잔류 자기를 없애기 위한 보자력 존재
    - 헤드의 코일에 전류가 흐르면 자장이 발생되는 전기적 성질 이용
  - 디스크 읽기
    - 저장된 데이터를 디스크 표면으로부터 감지하여 인출하는 동작
    - 자장이 존재하는 곳에 코일이 지나가면 코일에 전류가 발생하는 전기적 성질 이용
      - 디스크 표면이 회전하며 데이터가 저장된 트랙 부분이 헤드 밑을 통과하면 기록될 때와 동일한 극성의 전류 생성
- 임의 액세스(Random Access)
  - 주소에 의해 직접 기억장소를 찾아 액세스하며 어떤 기억 장소든 액세스하는 시간이 동일한 방식
    - 반도체 기억장치 등
  - 어떤 위치든지 임의로 선택될 수 있고 직접 주소 지정되고 액세스될 수 있음
    - 기억장치 내 어떤 위치를 액세스하든 그에 걸리는 시간이 항상 일정
- 연관 액세스(Associative Access)
  - 임의 액세스의 변형으로 저장된 내용의 특정 비트들을 비교하여 일치하는 내용을 액세스하는 방식
    - 연관 기억장치 등
  - CPU의 논리 주소에서 생성된 키 값에 연관되는 비트들과 변위 값과 일치하는 기억장소의 데이터 출력
  - 키 값의 비교에 걸리는 시간은 기억장소의 위치에 관계없이 일정
  - 일반적으로 모든 기억장소의 키 값들을 동시에 비교할 수 있는 하드웨어 포함

### 기억장치의 제조 재료에 따른 유형

- 반도체 기억장치(Semiconductor Memory)
  - 반도체 물질인 실리콘 칩을 이용한 기억장치로 부피가 작고 처리 시간이 매우 빠르나 열에 약함
  - 플립플롭 회로라고도 하는데 이 회로들은 0과 1을 기억하는 회로들이고 자기 코어 한 개와 같은 역할
- 자기 표면 기억장치(Magnetic Surface Memory)
  - 알루미늄 합금의 원판 표면에 자성물질을 입힌 보조기억장치
    - 자기 디스크(하드 디스크) 등
  - 정보는 다수의 동심원 위의 트랙에 기억되고 자기 헤드를 통해 기록 또는 판독됨

### 데이터를 저장하는 성질에 따른 유형

- 휘발성 기억장치(Volatile Memory)
  - 전원 공급이 중단되면 내용이 지워지는 기억장치
    - RAM(Random Access Memory) 등
  - 소멸성 반도체라고도 함
  - RAM
    - 임의 액세스 방식을 이용하는 반도체 집적회로
    - DRAM(Dynamic RAM)
      - 커패시터에 전하를 충전하는 방식
      - 기억 밀도가 높고 가격이 저렴하나 저장된 내용을 주기적으로 재충전해야 함
      - 용량이 큰 주기억장치로 많이 사용
    - SRAM(Static RAM)
      - 기억소자로 플립플롭을 이용하여 데이터가 안정된 상태에서 저장될 수 있음
      - 전력이 공급되는 동안에는 재충전 없이도 데이터를 계속 유지할 수 있음
      - 빠른 속도가 필요한 캐시 메모리로 사용
- 비휘발성 기억장치(Nonvolatile Memory)
  - 전원 공급에 관계없는 영구 저장장치
    - ROM(Read Only Memory), 디스크 등
  - 저장된 정보는 변경되기 전까지 그대로 유지
  - ROM
    - 내용을 읽는 것만 가능하고 쓰는 것은 불가능
      - 프로그램이나 변경할 수 없는 데이터를 저장하는 데 사용
    - 내용이 영구 저장되어 보조기억장치로부터 매번 이동시킬 필요가 없으므로 액세스 시간이 짧아짐
    - 대부분의 컴퓨터 시스템에서 RAM과 함께 주기억장치의 일부로 ROM을 사용



## 성능 결정 요소

### 메모리 용량(Memory Capacity)

- 메모리의 물리적인 크기로 메모리당 비트 수를 나타냄
  - 비트 수 대신 바이트 수와 단어 수를 의미하는 경우도 많음
  - 단어의 길이는 CPU가 실행할 명령어 길이나 내부 연산에서 한번에 처리할 수 있는 데이터 비트 수와 같음
- 외부 기억장치에서는 데이터가 단어보다 훨씬 더 큰 단위인 블록으로 전송되기도 함
  - 대부분의 시스템에서 주소지정 단위가 바이트

### 액세스 시간(Access Time)

- 주소와 읽기 및 쓰기 신호가 기억장치에 도착한 순간부터 데이터가 저장되거나 동작이 완료될 때까지의 시간
- 호출 시간이라고도 함
- 직접 액세스 장치에서 액세스 시간은 탐구 시간(Seek Tie)과 전송 시간(Transfer Time)으로 나눔
- 데이터 전송률(Data Transfer Rate)
  - 기억장치로부터 초당 읽혀지거나 쓰일 수 있는 비트 수
- 사이클 시간(Cycle Time)
  - 액세스 시간과 다음 액세스를 시작하기 위해 필요한 동작에 걸리는 추가적인 시간을 합한 시간
    - 추가적인 시간은 읽기 동작 후에 정보가 파괴되는 저장장치인 경우 이를 복원시키는 데 걸리는 시간
    - 자기 코어와  달리 반도체 기억장치나 디스크 등은 내용이 파괴되지 않아 액세스 시간과 사이클 시간이 같음



## 계층적 기억 장치 시스템

### 개념

- 일반적으로 컴퓨터 시스템의 기억장치의 성능은 접근 시간 등에 의해 평가됨
- 기억장치의 계층 구조
  - 중앙처리장치와 직접 연결된 기억장치는 처리 속도가 빠른 소용량, 고가격의 기억장치 사용
  - 자주 사용하지 않는 자료들이 저장되는 기억장치는 저속, 저가격인 대용량 기억장치 사용
  - 기억용량이 커질수록 주소 해독 및 정보 인출을 위한 주변 회로가 더 복잡해져 액세스 시간이 더 긺

### 계층구조의 효과 예

- 원하는 데이터가 첫 번째 계층의 기억장치에 있는 비율이 높아질수록 평균 액세스 시간이 그 기억장치의 액세스 시간에 접근
  - 두 계층의 기억장치를 사용한 효과를 더 크게 얻을 수 있음
- 두 번째 계층의 기억장치는 속도가 느린 대신 비트당 가격이 더 저렴
- 두 가지 기억장치를 계층적으로 사용하면 속도 및 용량 면에서 개선된 계층적 기억장치 시스템을 사용하게 됨

### 대책 방안

- 지역성(Locality)
  - CPU가 주기억장치의 특정 부분에 위치한 프로그램이나 데이터를 자주 또는 집중적으로 액세스하는 현상
  - 각 프로세스는 계속해서 주기억 공간의 페이지 프레임 내에 유지할 페이지들을 알아내는 것이 좋음
    - 스래싱을 예방하고 페이지 부재율을 감소시키기 위함
      - 스래싱(Thrashing)
        - 페이지 대체 현상이 너무 자주 일어나는 현상
        - 프로그램 수행보다 페이지 교환에 보내는 시간이 더 큰 경우
  - 시간 지역성(Temporal Locality)
    - 최근에 액세스된 프로그램이나 데이터가 가까운 미래에 다시 액세스될 가능성이 높음을 의미
    - 서브루틴, 순환구조를 갖는 서브루틴, 스택, 큐 등
  - 공간 지역성(Spatial Locality)
    - 기억장치 내에 인접하여 저장되어 있는 데이터들이 연속적으로 액세스될 가능성이 높음을 의미
    - 순차적 실행, 행렬 구조에서의 검색, 인접한 곳에 관련 자료구조나 처리 루틴을 기술하려는 경향 등
  - 작업 세트(Working Set) 이론
    - 1968년 데닝이 제안
    - 작업 세트
      - 특정 시간에 실행되는 프로그램에 지역성이 포함되는 페이지들의 집합
    - 많이 참조하는 페이지들을 실기억 공간에 상주하게 하여 스래싱을 줄이고자 하는 이론
    - 하나의 프로그램이 효율적으로 실행되기 위해 작업 세트가 주기억장치 내에 유지되어야 함
      - 그렇지 않은 경우 그 프로그램이 보조기억장치로부터 계속 페이지들을 요구하여 스래싱 초래



## 반도체 메모리

### RAM(Random Access Memory)

- 제어 신호들에 따른 동작
  - 기억장치 시스템이 여러 개의 칩들로 구성되는 경우 칩 선택 신호인 CS 신호에 의해 칩 선택 여부 결정
- 8x8 비트 RAM
  - 8개의 기억장소들로 구성되며 각 기억장소에는 8비트씩 저장할 수 있음
  - 3×8 디코더가 주소 비트들을 해독해 8개 출력들 중 하나 활성화
    - 출력 선이 연결된 기억장소가 선택되어 제어신호에 따라 동작 수행
- 16x4 비트 RAM
  - 16개의 기억장소들이 서로 다른 주소를 할당받으며 각 기억장소에는 4비트 데이터가 저장
  - 주소 지정을 위해 4비트 주소 필요
  - 4×16 디코더가 16개의 출력 신호들 중 하나를 활성화시켜 각 기억장소가 선택됨
- 64x1 비트 RAM
  - 8×8 장방형 구조에 위치한 64개의 기억소자들에 대해 읽기 및 쓰기가 1비트씩 이뤄짐
    - 데이터 입출력 선이 1개
  - 각 기억장소가 별도의 주소를 가지므로 6비트 주소 필요
  - 일반적으로 주소 비트들이 두 그룹으로 나뉘어 별도로 디코딩됨
    - 두 개의 3×8 디코더 필요

### ROM(Read Only Memory)

- 제어 신호들에 따른 동작
  - 읽기만 가능하므로 WR(쓰기) 신호 없이 RD(읽기) 신호만 있으면 됨
  - CS와 RD 신호가 활성화되면 주소가 지정하는 기억장소로부터 데이터가 읽혀져 데이터 버스에 실리게 됨
  - 대부분의 ROM은 데이터 출력 선이 8개인 조직 사용
- 종류
  - 마스크 ROM(Mask ROM)
    - 제조 시에 데이터를 넣기 때문에 이후 내용을 바꿀 수 없어 융통성은 없으나 대량 생산에 적합
    - 제조 과정
      - 사용자가 제품에 대한 규격을 설계하고 회로도를 만들어 프로그램 작성 후 제조업자에 작성 의뢰
      - 제조업자는 ES(Engineering Sample)를 만들고 제품업자는 ES를 실제 응용제품에 넣어 시험 평가
      - 평가가 통과되면 제조업자가 대량 생산
  - PROM(Programmable ROM)
    - 사용자가 1회에 한해 기록할 수 있으나 내용은 소멸되지 않고 다시 기록할 수도 없음
    - 일반 동작 시보다 더 높은 전압의 신호를 발생할 수 있는 롬라이터(ROM Writer) 필요
    - OTPROM(One Time Programmable ROM)
      - 내장된 반도체 칩은 EPROM과 같으나 소거용 유리창이 없어 데이터를 지우고 다시 쓸 수 없음
      - EPROM보다 저렴하여 한번만 기록하는 용도에서 EPROM 대신 사용
  - EPROM(Erasable PROM)
    - 내용을 지울 수도 있어 여러 번 기록할 수 있음
      - 쓰기 전에 자외선을 이용하여 내용들을 지워 초기 상태와 같아지도록 해야 함
    - 평가 테스트의 결과가 좋지 않으면 현장에서 몇 번이고 다시 기록하여 쓸 수 있음
    - 양산의 경우 가격이 저렴한 ROM이 유리
  - EEPROM(Electrically Erasable PROM)
    - 전기적으로 삭제 가능한 EPROM으로 쓰기 전 그 이전 내용을 지울 필요가 없음
      - 내용 갱신은 특정 바이트 혹은 여러 바이트들에 대해 가능
    - EAROM(Electrically Alterable ROM)
      - 전기적으로 특정한 비트의 정보를 바꿀 수 있는 ROM
    - EEPROM는 전용 소거기가 따로 필요하지 않고 롬라이터를 사용하여 기록하고 지울 수 있음
    - 모뎀, 비디오 카드, SCSI(Small Computer System Interface) 제어기 등에서 사용
    - 10만 번까지 재기록 가능
  - 플래시 메모리(Flash Memory)
    - 1980년대 중반에 처음 소개되어 가격과 기능 면에서 EPROM과 EEPROM의 중간 정도
    - 전기적으로 삭제하는 기술을 사용하고 EEPROM보다 훨씬 빠름
    - 현재로써 1,000여 회밖에 재기록할 수 없음



## 메모리 모듈 맵

- 메모리 맵(Memory Map)
  - 시스템 설계자가 각 칩에 할당한 번지의 범위를 지정한 표
- 기억장치 칩의 데이터 비트 수가 단어 길이보다 짧은 경우
  - 여러 개의 칩들을 병렬로 접속한 기억장치 모듈로 구성
- 필요한 기억장치 용량이 각 기억장치 칩의 용량보다 큰 경우
  - 여러 개의 칩들을 직렬로 접속한 기억장치 모듈로 구성



## 캐시메모리

- 캐시 메모리(Cache Memory)
  - 주로 CPU와 주기억장치 사이에 사용하는 빠른 속도의 메모리
  - 컴퓨터가 작업에 주로 사용하는 메인메모리의 액세스 타임을 줄이기 위한 목적으로 사용

### 계층 구조

- 온 칩(On-chip) 캐시
  - 프로세서 칩 내부에 캐시메모리를 내장한 것
- 싱글코어 프로세서
  - 일반적으로 L1, L2 캐시는 각각 CPU 코어 내부와 CPU 칩 내부에 위치
- 멀티코어 프로세서
  - 일반적으로 L1, L2 캐시를 각 코어가 독점하고 L3 캐시를 CPU 칩 내부의 공유 캐시로 사용
  - L3 캐시는 각 멀티코어에서 다중 작업이나 하나의 작업을 나눠 처리할 때 일관성을 유지해줌
- 메모리 이중독립버스(DIB, Dual Independent Bus)
  - 메모리 버스의 한계를 극복하는 방법
    - 시스템 버스와 캐시 버스의 데이터 비트 수가 같을 때 단일버스 방식보다 전송속도가 개선됨
  - 전면버스(FSB, Front Side Bus)
    - CPU와 메인 메모리 사이의 시스템 버스
    - 주기억장치에 주로 사용하는 RAM 모듈의 속도나 시스템버스의 클록 등을 언급할 때 사용
  - 후면버스(BSB, Back Side Bus)
    - CPU 코어와 캐시메모리 사이의 캐시버스가 두 개의 독립적인 버스 구조를 갖는 경우
    - 보통 시스템 버스로 사용되는 FSB보다 비트 수를 넓히고 클록도 고속으로 설계

### 캐시 설계 시 고려사항

- 평균 액세스 타임
  - CPU가 한번 이상 액세스한 내용은 캐시에 복사됨
    - 캐시에서 원하는 내용을 찾지 못하면 주기억장치에서 새로운 내용을 읽어 캐시메모리에 저장
    - 한동안 사용되지 않았던 내용들은 지워짐
  - 캐시 실패율(Miss Ratio)
    - CPU가 원하는 프로그램이나 데이터가 캐시메모리에 없을 확률
    - 부적중률이라고도 함
  - 캐시 적중률(Hit Ratio)
    - CPU가 원하는 프로그램이나 데이터가 캐시메모리에 있을 확률
    - 캐시 적중률 = 캐시 적중 횟수 / 전체 메모리 액세스 횟수
    - 캐시 적중률이 높을수록 전체 기억장치의 평균 액세스 시간이 빨라져 캐시의 액세스 시간에 가까워짐
  - 평균 액세스 시간은 실제 액세스가 일어나는 장소의 비율과 속도에 따라 계산
- 캐시의 크기
  - 용량이 커질수록 적중률이 높아짐
    - 비용도 같은 비율로 상승하므로 상호조정을 통해 적절히 결정되어야 함
    - 주소 디코딩 및 정보 인출을 위한 주변 회로가 더 복잡해지므로 액세스 시간이 다소 길어짐
- 캐시와 주기억장치의 일관성
  - 캐시와 주기억장치의 데이터 일관성에 걸리는 시간을 최소화해야 함
  - 캐시에서 데이터가 변경되더라도 주기억장치에는 갱신하지 않는 것
    - 쓰기 동작이 캐시에서만 수행되므로 쓰기 시간이 짧아짐
    - 교체 알고리즘에 의해 데이터가 교체되어야 하는 경우 그 내용을 주기억장치에 갱신한 다음 교체
    - 데이터를 교체할 때마다 캐시에 적재되어 있는 동안 변경된 적이 있는지 반드시 확인해야 함
    - 쓰기 정책(Write Policy)
      - 연속 기록(Write Through)
        - CPU가 캐시메모리와 주기억장치 두 곳의 데이터를 정상적으로 함께 갱신하는 방식
        - 캐시메모리의 속도가 주기억장치보다 빨라 캐시메모리가 먼저 업데이트되고 주기억장치에 기록이 완료됨
        - 구조는 간단하나 캐시가 갱신될 때마다 주기억장치를 매번 함께 액세스하므로 성능이 떨어짐
        - 쓰기 동작에 걸리는 시간이 길어짐
      - 후기록(Write Back)
        - 캐시에서 데이터가 변경되어도 주기억장치에는 갱신되지 않음
        - 기억장치에 대한 쓰기 동작의 횟수가 최소화
        - 쓰기 동작이 캐시까지만 이뤄지므로 쓰기 시간이 짧아짐
        - 주기억장치의 일부 블록들이 새로운 내용으로 갱신할 때까지는 무효 상태에 있음
        - 데이터 교체나 I/O 장치에 대한 주기억장치 액세스가 이뤄질 때는 반드시 캐시의 상태를 확인하여 갱신하는 동작이 선행되어야 함
          - 제어 회로가 복잡하고 각 캐시 슬롯이 상태 비트를 갖고 있어야 함
- 사상(Mapping) 방식
  - 주기억장치 블록들이 공유할 캐시 슬롯을 결정하는 방법
  - 직접 사상 방식
    - 주기억장치의 블록들이 지정된 어느 한 캐시 슬롯으로만 사상될 수 있음
    - 주소 사상 과정
      - 태그 필드는 지정된 슬롯에 들어갈 블록을 구분
      - 슬롯 필드는 캐시 슬롯을 구분
      - 단어 필드는 지정된 블록 내의 단어를 구분
  - 완전 연관 사상
    - 주기억장치 블록이 캐시의 어느 슬롯이든지 적재될 수 있도록 허용하여 직접 사상 방식의 단점 보완
    - 캐시 액세스 과정에서 주기억장치 주소가 태그 필드와 단어 필드로만 구성
    - 프로그램 세그먼트나 데이터 배열 자체가 캐시로 적재될 수도 있음
    - 캐시 슬롯들의 태그들을 동시에 검사하기 위해 복잡하고 비용이 높은 하드웨어를 포함해야 함
      - 실제 시스템에서는 거의 사용되지 않음
    - 주소 사상 과정
      - 태그 필드는 캐시 슬롯에 들어갈 블록을 구분
      - 단어 필드는 지정된 블록 내의 단어를 구분
  - 세트 연관 사상
    - 주기억장치에 있는 블록들이 복수의 캐시 슬롯을 묶은 지정된 슬롯 세트에 들어갈 수 있음
    - 주소 사상 과정
      - 태그 필드는 지정된 세트에 들어갈 블록을 구분
      - 세트 필드는 캐시 슬롯 세트를 구분
      - 단어 필드는 지정된 블록 내의 단어를 구분