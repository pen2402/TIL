# 상품을 구매한 회원 비율 구하기

```mysql
WITH JOINED_USERS AS (
    SELECT USER_ID
    FROM USER_INFO
    WHERE YEAR(JOINED) = 2021
),
JOINED_USER_COUNT AS (
    SELECT COUNT(USER_ID) AS TOTAL
    FROM USER_INFO
    WHERE YEAR(JOINED) = 2021
)

SELECT
    YEAR(A.SALES_DATE) AS YEAR,
    MONTH(A.SALES_DATE) AS MONTH,
    COUNT(DISTINCT A.USER_ID) AS PURCHASED_USERS,
    ROUND(COUNT(DISTINCT A.USER_ID)/(SELECT TOTAL FROM JOINED_USER_COUNT), 1) AS PURCHASED_RATIO
FROM
    ONLINE_SALE A
    INNER JOIN JOINED_USERS B ON A.USER_ID = B.USER_ID
GROUP BY YEAR, MONTH
ORDER BY YEAR, MONTH;
```

